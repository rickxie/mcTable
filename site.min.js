var mmGrid={};window.onload=function(){function h(){var v=mmGrid=this;var C=v._={};var y={row_select:[]};v.fire=function(E){switch(E){case"row_select":y.row_select.forEach(function(G){var F=j.filter(function(H){return H.$$checked===true});G(F)})}};v.on=function(E,F){y[E]!==null&&(y[E].push(F))};var z={table:"",tr:null,td:null};var q={$$allChecked:false,checkable:false,sortable:false,tableWidth:"",fixHeaderRow:true,fixColumnNum:0,mergeColumnMainIndex:null,mergeColumns:null};var A=[];var j=[];v.InitGrid=function(I,G,H,K){A=H;s(K);m(G);var J=document.getElementById(I);z.table=C.getDefaultClass("#"+I+" table");J.removeClass("mc-table");J.addClass("mc-table");var F={wraperContainer:r("div","mc-table-wrapper mc-default"),headDivDom:r("div","mc-thead"),bodyDivDom:r("div","mc-tbody"),fixedColumn:r("div","mc-fixed-column"),fixedBody:r("div","mc-fixed-body")};var E=F.wraperContainer;var L=B(A);var N=p(A,K);var M=u("table",L+N,z.table,{width:q.tableWidth});F.bodyDivDom.innerHTML=M;n(F);J.innerHTML="";E.style.visibility="hidden";J.appendChild(E);setTimeout(function(){D(J,F);E.style.visibility="visible"},0)};var n=function(E){if(q.fixHeaderRow&&q.fixColumnNum>0){E.fixedBody.appendChild(E.headDivDom);E.fixedBody.appendChild(E.bodyDivDom);E.wraperContainer.appendChild(E.fixedColumn);E.wraperContainer.appendChild(E.fixedBody)}else{if(q.fixHeaderRow&&q.fixColumnNum==0){E.wraperContainer.appendChild(E.headDivDom);E.wraperContainer.appendChild(E.bodyDivDom)}else{if(!q.fixHeaderRow){E.wraperContainer.appendChild(E.bodyDivDom)}}}};var D=function(O,M){var J=M.headDivDom;var S=M.bodyDivDom;if(q.fixHeaderRow){var U=S.children[0];var T=U.children[0].offsetHeight;var Q=O.offsetHeight-T;var P=U.cloneNode(true);P.removeChild(P.children[1]);U.removeChild(U.children[0]);J.appendChild(P);S.style.height=Q;var W=S.offsetWidth>U.offsetWidth?S.offsetWidth:U.offsetWidth;U.style.width=(W-20);P.style.width=W}t(S);if(q.fixColumnNum>0){var R=O.querySelector(".mc-fixed-body .mc-thead");var V=O.querySelector(".mc-fixed-body .mc-tbody");var I=R.querySelector("table");var K=V.querySelector("table");V.style.width=O.offsetWidth+"px";var H=R.cloneNode(true);var L=V.cloneNode(true);var E=H.querySelector("table");var F=L.querySelector("table");var N=E.rows;C.forEach(N,function(Z,X){for(var Y=0;Y<Z.cells.length;Y++){if(Y>=q.fixColumnNum){Z.cells[Y].style.display="none"}else{Z.cells[Y].style.width=I.rows[X].cells[Y].offsetWidth;Z.cells[Y].style.height=I.rows[X].cells[Y].offsetHeight}}});var N=F.rows;C.forEach(N,function(Z,X){for(var Y=0;Y<Z.cells.length;Y++){if(Y>=q.fixColumnNum){Z.cells[Y].style.display="none"}else{Z.cells[Y].style.width=K.rows[X].cells[Y].offsetWidth;Z.cells[Y].style.height=K.rows[X].cells[Y].offsetHeight}}});var G=O.querySelector(".mc-fixed-column");E.style.width=null;F.style.width=null;L.style.width=null;M.fixedBody.style.width=V.offsetWidth;L.style.height=V.clientHeight;G.appendChild(H);G.appendChild(L)}g(O,S,J,M)};var g=function(I,F,J,E){F.onscroll=function(O){J.scrollLeft=this.scrollLeft;if(q.fixColumnNum>0){var N=E.fixedColumn.querySelector(".mc-tbody table");N.style.marginTop=-this.scrollTop}};var K=I.getElementsByTagName("tr");function G(N,O){K.forEach(function(Q){var P=Q.getAttribute("ri");if(P===N){if(O){Q.addClass("hover")}else{Q.removeClass("hover")}}})}C.forEach(K,function(N){N.onmouseover=function(){var O=N.getAttribute("ri");G(O,true)};N.onmouseout=function(){var O=N.getAttribute("ri");G(O,false)}});if(q.checkable===true){var M=I.getElementsByTagName("td").filter(function(N){return N.getAttribute("ci")==="-1"&&N.getAttribute("ri")!=="-1"});var L=I.getElementsByTagName("th").filter(function(N){return N.getAttribute("ci")==="-1"&&N.getAttribute("ri")==="-1"});M.forEach(function(O){var N=O.querySelector("input[type=checkbox]");N.onchange=function(){var Q=this.checked;var S=this.parentTag("tr");var T=S.getAttribute("ri");var P=I.querySelectorAll('tr[ri="'+T+'"]');P.forEach(function(U){var V=U.querySelector("input[type=checkbox]");V.checked=Q;if(Q){U.addClass("checked")}else{U.removeClass("checked")}});var R=C.first(j,{$$index:T});R.$$checked=Q;v.fire("row_select")}});function H(N){L.forEach(function(P){var O=P.querySelector("input[type=checkbox]");O.checked=N;q.$$allChecked=N;M.forEach(function(S){var R=S.querySelector("input[type=checkbox]");R.checked=N});j.forEach(function(R){R.$$checked=N});var Q=I.getElementsByTagName("tr").filter(function(R){return R.getAttribute("ri")!=="-1"});Q.forEach(function(R){if(N){R.addClass("checked")}else{R.removeClass("checked")}});v.fire("row_select")})}L.forEach(function(O){var N=O.querySelector("input[type=checkbox]");N.onchange=function(){H(this.checked)}})}};var m=function(E){C.extend(q,E);var H=0;for(var F=0;F<A.length;F++){A[F]=C.extend({"min-width":"50px",width:"50px",visible:true},A[F]);var G=parseFloat(A[F].width);H+=G}if(q.checkable){H+=30}A[A.length-1].width=null;q.tableWidth=H+"px"};var r=function(E,F){var G=document.createElement(E);G.className=F;return G};var s=function(E){C.forEach(E,function(G,F){G.$$index=F;G.$$checked=false});j=E};var b=function(I,H){var G=B(I);var F=p(I,H);var E=u("table",G+F,z.table);return E};var B=function(I){var H=[];C.forEach(A,function(K,J){if(K.visible){H.push(u("th",K.text,null,K,-1,J))}});if(q.checkable){var E=u("th","<input type='checkbox'/>","check-all check-btn",null,-1,-1);H.unshift(E)}var G=u("tr",H.join(""),null,null,-1);var F=u("thead",G);return F};var l=function(F){var G=[];var E=["width","text-align"];C.forEach(E,function(H){if(F[H]!=null){G.push(H+":"+F[H])}});return G.join(";")};var u=function(I,K,F,G,E,H){var F=F!=null?' class = "'+F+'"':"";var J="";if(G!=null){J=l(G);J=J!=null?' style = "'+J+'"':""}(H!==undefined&&(H=' ci="'+H+'" '))||(H===undefined&&(H=""));(E!==undefined&&(E=' ri="'+E+'" '))||(E===undefined&&(E=""));var L="<"+I+F+E+H+J+">"+K+"</"+I+">";return L};var p=function(G,F){var H=[];var E=[];C.forEach(F,function(L,K){H=[];C.forEach(A,function(N,M){if(N.visible){H.push(u("td",L[N.name],null,N,L.$$index,M))}});if(q.checkable){var J=u("td","<input type='checkbox'/>","check-btn",null,L.$$index,-1);H.unshift(J)}E.push(u("tr",H.join(""),null,null,L.$$index))});var I=u("tbody",E.join(""));return I};C.forEach=function(E,G){var F=0;for(F=0;F<E.length;F++){G(E[F],F)}};C.filter=function(E,H){var F=[];var G=0;for(G=0;G<E.length;G++){if(H(E[G])){F.push(E[G])}}return F};C.first=function(E,H){for(var G=0;G<E.length;G++){if(H instanceof Object){var F=true;for(name in H){if(H[name]!=E[G][name]){F=false;break}}if(F){return E[G]}}else{if(H instanceof Function){if(H(E[G])){return E[G]}}}}};C.extend=function(){var F,H;F=function(J){return Object.prototype.toString.call(J)==="[object Object]"};H=function G(L,K){var J;for(J in K){if(F(L[J])&&F(K[J])){G(L[J],K[J])}L[J]=K[J]}};var E=arguments;if(E.length<=1){return}else{var I;for(I=1;I<E.length;I++){H(E[0],E[I])}}if(E.length>0){return E[0]}};C.getDefaultClass=function(E){var F=document.querySelectorAll(E);if(F!=null&&F.length>0){return F[0].className}};C.all=function(F,H){var E=true;for(var G=0;G<F.length;G++){if(!H(F[G])){E=false;break}}return E};C.clone=function(H){if(null==H||"object"!=typeof H){return H}if(H instanceof Date){var I=new Date();I.setTime(H.getTime());return I}if(H instanceof Array){var I=[];for(var G=0,F=H.length;G<F;++G){I[G]=clone(H[G])}return I}if(H instanceof Object){var I={};for(var E in H){if(H.hasOwnProperty(E)){I[E]=clone(H[E])}}return I}throw new Error("Unable to copy obj! Its type isn't supported.")};NodeList.prototype.forEach=HTMLCollection.prototype.forEach=Array.prototype.forEach=function(E){C.forEach(this,function(F,G){E(F,G)})};NodeList.prototype.filter=HTMLCollection.prototype.filter=Array.prototype.filter=function(E){return C.filter(this,E)};Element.prototype.addClass=function(E){var H=this;var F=H.className;if(F!=null){F.replace(/(\s+)/gi," ");var G=F.split(" ");if(G.indexOf(E)>-1){return}}blank=(F!="")?" ":"";added=F+blank+E;H.className=added};Element.prototype.removeClass=function(E){var G=this;var F=" "+G.className+" ";F=F.replace(/(\s+)/gi," "),removed=F.replace(" "+E+" "," ");removed=removed.replace(/(^\s+)|(\s+$)/g,"");G.className=removed};Element.prototype.hasClass=function(E){var H=this;var F=H.className,G=F.split(/\s+/);x=0;for(x in G){if(G[x]==E){return true}}return false};Element.prototype.parentTag=function(F){var E=this.parentNode;do{if(E.tagName.toUpperCase()===F.toUpperCase()||E.tagName.toUpperCase()=="BODY"){break}var E=E.parentNode}while(true);if(E.tagName.toUpperCase()==="BODY"){return null}else{return E}};function w(E){return(E|0)===E}var t=function(E){if(q.mergeColumnMainIndex!=null&&q.mergeColumns!=null&&q.mergeColumns.length>0&&w(q.mergeColumnMainIndex)){var F=[];a(F);o(E,F)}};function a(F){var E=q.mergeColumnMainIndex;var N=j;var G=null;var I="";for(var H=0;H<A.length;H++){if(A[H].visible===true){G==null?G=0:G+=1}if(G==E){I=A[H].name;break}}var M=[];var L=[];var J=null;for(var H=0;H<N.length;H++){var K=N[H][I];if(J===null){J=K}if(K===J){L.push(H)}else{M.push(L);L=[];L.push(H);J=K}}if(L.length!=0){M.push(L)}F=M}function o(G,H){var F=q.mergeColumns;F=F.sort(function(J,I){return J>I});var E=G.querySelectorAll("tr").filter(function(I){return I.getAttribute("ri")!=="-1"});E.forEach(function(I){var K=I.children;var J=I.getAttribute("ri");K.forEach(function(L){var M=L.getAttribute("ci")})})}}var f=[{name:"id",text:"编号",width:"100px"},{name:"name",text:"姓名",width:"100px"},{name:"address",text:"地址",width:"250px"},{name:"money",text:"金额",width:"100px","text-align":"right"},{name:"birthDay",text:"出生日期",width:"100px",visible:true}];var k=[{id:"1111",name:"小明",address:"漕河泾250号",money:100,birthDay:"2015-12-12"},{id:"2222",name:"小红",address:"新传公路1550号",money:2005,birthDay:"2015-12-12"},{id:"2222",name:"小红2",address:"新传公路1550号3",money:2005,birthDay:"2015-12-12"},{id:"3333",name:"小兰",address:"小和家园顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶顶2001号",money:3000,birthDay:"2015-12-12"}];for(var e=0;e<20;e++){k.push({id:"3333",name:"小兰",address:"小和家园2001号",money:30000,birthDay:"2015-12-12"})}var d=new Date();var i=new h();i.InitGrid("mc-table",{checkable:true,fixHeaderRow:true,fixColumnNum:2,mergeColumnMainIndex:0,mergeColumns:[0,1,2]},f,k);var c=new Date();i.on("row_select",function(a){console.log(a)});console.log("耗时:"+(c-d)+"毫秒")};